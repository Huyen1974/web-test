name: Terraform Deploy

on:
  push:
    branches: [main]
    paths:
      - 'terraform/**'
  pull_request:
    branches: [main]
    paths:
      - 'terraform/**'
  workflow_dispatch:

permissions:
  contents: read
  id-token: write
  actions: read

jobs:
  terraform:
    uses: ./.github/workflows/terraform-apply.yml
    with:
      project_id: ${{ secrets.GCP_PROJECT_ID }}
      service_account: ${{ secrets.GCP_SERVICE_ACCOUNT }}
      workload_identity_provider: ${{ secrets.GCP_WIF_PROVIDER }}
      terraform_directory: ./terraform
      backend_bucket: huyen1974-web-test-tfstate
      backend_prefix: terraform/state
      terraform_version: "1.9.0"
      auto_apply: false
