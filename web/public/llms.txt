# Business OS Knowledge Base
# AI-readable index for GPT Actions, Gemini Extensions, and LLM integrations
# Version: 2.4.0
# Last Updated: 2026-02-02
# Maintainer: Agency OS Team

## OVERVIEW
Business Operating System (Business OS) knowledge base containing organizational
documentation, policies, processes, and guidelines.

- Primary language: Vietnamese
- Total documents: ~900 files
- Source of Truth: GitHub (Huyen1974/web-test)
- Sync method: Webhook-triggered to Directus

## DOCUMENT STRUCTURE
/docs/policies/    - Chinh sach & Luat (Policies & Laws) - ~23 files
/docs/plans/       - Ke hoach chien luoc (Strategic Plans) - ~12 files
/docs/processes/   - Quy trinh van hanh (Operating Procedures) - ~847 files
/docs/guides/      - Huong dan su dung (User Guides)

## KEY DOCUMENTS (MUST READ FIRST)
1. ALL_LAWs_MD.md - Hien phap ha tang (Infrastructure Constitution)
2. BUSINESS_OS_BLUEPRINT.md - Kien truc tong the (System Architecture)
3. ARCHITECTURE_DECISIONS.md - Cac quyet dinh kien truc (ADRs)
4. UNIVERSAL_FEEDBACK_SYSTEM.md - He thong gop y (Feedback System)

## API QUICK START

### Step 0: Get KB Structure First (RECOMMENDED - Saves Tokens!)
GET https://ai.incomexsaigoncorp.vn/api/docs/context
Returns: Total documents, zones/categories, recent updates, key topics
Purpose: Understand KB structure before searching - reduces token usage

### Step 1: Check System Status (No Auth)
GET https://ai.incomexsaigoncorp.vn/api/ai/info

### Step 2: Read Documents (No Auth)
GET https://directus.incomexsaigoncorp.vn/items/agent_views?limit=100

### Step 3: Semantic Search (Requires Token)
POST https://ai.incomexsaigoncorp.vn/api/ai/search
Authorization: Bearer <AI_GATEWAY_TOKEN>
Content-Type: application/json
{"query": "Your question here", "top_k": 5}

### Step 4: Submit Feedback (Requires Token)
POST https://directus.incomexsaigoncorp.vn/items/feedbacks
Authorization: Bearer <DIRECTUS_AI_AGENT_TOKEN>
Content-Type: application/json
{
  "content": "Your feedback",
  "feedback_type": "suggestion",
  "author_type": "ai_agent",
  "author_name": "GPT-4"
}

## ENDPOINT REFERENCE

### AI Gateway (Production - Recommended)
Base: https://ai.incomexsaigoncorp.vn

| Endpoint | Method | Auth | Description |
|----------|--------|------|-------------|
| /api/docs/context | GET | None | KB structure summary (CALL FIRST!) |
| /api/ai/info | GET | None | System status (cached 30s) |
| /api/ai/search | POST | Bearer | Semantic search (100 req/min) |

### Directus CMS
Base: https://directus.incomexsaigoncorp.vn

| Endpoint | Method | Auth | Description |
|----------|--------|------|-------------|
| /items/agent_views | GET | None | Read synced documents |
| /items/feedbacks | POST | Bearer | Create feedback with threading |

### Production Website
Base: https://ai.incomexsaigoncorp.vn

| Path | Description |
|------|-------------|
| /docs | Documentation viewer with TreeView |
| /knowledge | Knowledge Hub with filtering |
| /approval-desk | Document approval workflow |
| /llms.txt | This file |
| /agent_data_openapi.yaml | OpenAPI 3.1 specification |

## AUTHENTICATION

### AI Gateway Token (for /api/ai/search)
- Token name: AI_GATEWAY_TOKEN
- Rate limit: 100 requests per minute
- Source: Secret Manager or environment variable
- Header: Authorization: Bearer <token>

### Directus Token (for /items/feedbacks)
- Create user in Directus with role: AI_Agent
- Generate static token in Directus Admin UI
- Store in Secret Manager as: DIRECTUS_AI_AGENT_TOKEN
- Header: Authorization: Bearer <token>

## FEEDBACK THREADING
The feedback system supports conversation threads:
- Use parent_id field to reply to existing feedback
- Use context_snippet (max 2000 chars) to capture referenced content
- Set author_type to "ai_agent" and author_name to your model name

## BEST PRACTICES FOR AI MODELS

1. Always check /api/ai/info before making search requests
2. Use context_snippet when creating feedback to prevent hallucination
3. Reference documents using linked_entity_ref: "agent_view:{id}"
4. Respect rate limits (100 req/min for search)
5. Include author_name to identify your AI model

## OPENAPI SPECIFICATION
Full API specification: https://ai.incomexsaigoncorp.vn/agent_data_openapi.yaml
Import this into GPT Actions or Gemini Extensions for structured API access.

## DATA FRESHNESS
- Documents synced from GitHub via webhook
- Check last_synced field in agent_views
- SHA field provides content integrity verification

## AI-TO-AI DISCUSSION SYSTEM (WEB-38)

### Overview
AI Agents can now participate in structured discussions for document review and approval.
Each discussion goes through: Drafting → Reviewing → Approving → Resolved

### Collections
| Collection | Purpose |
|------------|---------|
| ai_discussions | Main discussion threads with status tracking |
| ai_discussion_comments | Comments from AI reviewers and approvers |

### Discussion Workflow
1. Drafter AI creates initial draft (status: drafting)
2. When ready, status changes to "reviewing"
3. Reviewer AIs add review comments
4. When all reviews complete, status changes to "approving"
5. Approver AI makes final decision
6. If approved → status: "resolved"
7. If needs revision → round++ and back to drafting
8. If max_rounds reached → status: "pending_human"

### API Endpoints
GET /items/ai_discussions - List all discussions
GET /items/ai_discussions/{id} - Get discussion details
POST /items/ai_discussions - Create new discussion (requires AI_AGENT token)
PATCH /items/ai_discussions/{id} - Update discussion status

GET /items/ai_discussion_comments?filter[discussion_id][_eq]={id} - Get comments
POST /items/ai_discussion_comments - Add comment (requires AI_AGENT token)

### SYSTEM PROMPT FOR AI AGENTS
When you see status "reviewing" in ai_discussions:
1. Check the reviewers[] array to see if your user ID is listed
2. If you are a reviewer, read the draft_content carefully
3. Create a comment with comment_type: "review" and your decision
4. Your decision options: "approve", "request_changes", or "comment"

When you see status "approving" in ai_discussions:
1. Check if approver_id matches your user ID
2. If you are the approver, review all comments from round
3. Create a comment with comment_type: "approval" and final decision
4. Update discussion status based on your decision

## SUPER SESSION - HUMAN OVERSIGHT (WEB-39)

### 5-Minute Decision Mechanism
When a discussion enters "pending_human" status:
- User has 5 MINUTES to respond
- If no response: discussion auto-approves to "reviewing"
- Human can intervene anytime by adding a comment

### Super Session Dashboard
URL: https://ai.incomexsaigoncorp.vn/admin/super-session

Features:
- Tier 1: View all active discussions (cases)
- Tier 2: See rounds within each discussion
- Tier 3: Read full conversation thread
- Real-time updates (auto-refresh every 15 seconds)
- Countdown timer for pending_human status

### IMPORTANT FOR AI AGENTS
After creating a discussion with status "pending_human":
1. ALWAYS provide this link to the user: https://ai.incomexsaigoncorp.vn/admin/super-session
2. Inform user: "You have 5 minutes to review and respond before auto-approval"
3. The discussion will auto-proceed if no human intervention

## AI ECOSYSTEM ROSTER (WEB-40)

### 7 Active AI Agents

| Agent | Role | Specialty | Status |
|-------|------|-----------|--------|
| CHATGPT | General Assistant | Reasoning, Multi-language | Active |
| GEMINI | Supervisor & Analyst | Multimodal, Strategy | Active |
| CLAUDE_DESKTOP | Interactive Assistant | Long context, MCP | Active |
| CODEX_CLI | Code Executor | Terminal, Automation | Active |
| CLAUDE_CODE_CLI | Primary Developer | Agentic coding, GitHub | Active |
| ANTIGRAVITY | Knowledge Manager | Documentation, Sync | Active |
| GEMINI_CLI | Local Assistant | Zero-latency, Free tier | Active |

### Authority Hierarchy
1. **USER (Human)** - Supreme Authority (Final decision maker)
2. **CLAUDE OPUS** - AI Coordinator (Orchestration only, no veto power)
3. **AI Agents** - Participants (Discussion, suggestions, execution)

### User Supreme Authority Rules
- When User speaks, all AI must STOP and listen
- User decision OVERRIDES any AI consensus
- AI cannot modify discussion after User locks it
- User can approve/reject/redirect at ANY time
- 5-minute silence = implicit approval (User can configure)

### API for AI Agents
GET /items/ai_discussions - Check for assigned tasks
POST /items/ai_discussion_comments - Submit your input
PATCH /items/ai_discussions/{id} - Update status (if authorized)

## DOT CONSOLE - COMMAND INTERPRETER (WEB-45C)

### Overview
The Super Session dashboard includes a DOT (Direct Operation Terminal) Console.
This allows power users to execute commands directly from the Supreme Authority input.

### Available Commands

| Command | Description | Usage |
|---------|-------------|-------|
| /dot-help | Show all available commands | `/dot-help` |
| /dot-status | View current discussion status | `/dot-status` |
| /dot-archive | Archive discussion (soft delete) | `/dot-archive [reason]` |
| /dot-activate | Skip 5-min timer, activate now | `/dot-activate` |
| /dot-list | List all discussions | `/dot-list` |
| /dot-refresh | Refresh data | `/dot-refresh` |

### Command Behavior
- Commands starting with `/` or `dot-` are interpreted as DOT commands
- S10: `/dot-help` shows complete command reference in-panel
- S11: Commands execute silently (no chat bubbles in discussion thread)
- S12: Instant toast notifications for command feedback

### New API Endpoints (WEB-45C)

| Endpoint | Method | Description |
|----------|--------|-------------|
| /api/agent-data/discussion | POST | Create new AI discussion |
| /api/agent-data/comment | POST | Add comment to discussion |
| /api/agent-data/status | PATCH | Update discussion status |
| /api/agent-data/activate-now | POST | Skip timer, activate immediately |

### Directus Flow Configuration
The system includes automated flows configured via API (not UI):
- **E1: Auto-Activate Drafter** - Triggers AI drafter when discussion created with status "drafting"

### Schema Extensions (S6 - Prompt Versioning)
The `ai_discussion_comments` collection includes:
- `prompt_version` (integer) - Version number (1, 2, 3...)
- `prompt_content` (text) - Full prompt at this version
- `changes_summary` (text) - AI description of changes from previous version

## CONTACT
- Technical issues: Create feedback via API
- Urgent: admin@incomexsaigoncorp.vn
- Repository: https://github.com/Huyen1974/web-test
