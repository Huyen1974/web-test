# WEB-39: Secret Migration Report

**Date:** 2026-02-01
**Agent:** Claude Code (Opus 4.5)
**Status:** COMPLETE

---

## Migration Summary

Migrated 3 secrets from `automatic` replication to `user-managed` in `asia-southeast1` per "Hiến pháp" compliance requirements.

---

## Before/After

| Old Secret Name | New Secret Name | Old Replication | New Replication | Location |
|-----------------|-----------------|-----------------|-----------------|----------|
| AI_GATEWAY_TOKEN | ai-gateway-token | automatic | user-managed | asia-southeast1 |
| DIRECTUS_AI_AGENT_TOKEN | directus-ai-agent-token | automatic | user-managed | asia-southeast1 |
| GCS_CREDENTIALS_test | gcs-credentials-test | automatic | user-managed | asia-southeast1 |

---

## Affected Resources

### Cloud Run Service Updated
- **Service:** nuxt-ssr-pfne2mqwja
- **Change:** Updated secret reference from `AI_GATEWAY_TOKEN` to `ai-gateway-token`

### Workflow Updated
- **File:** `.github/workflows/firebase-deploy.yml`
- **Line 86:** `--update-secrets="AI_GATEWAY_TOKEN=ai-gateway-token:latest"`

---

## Verification

```bash
# All new secrets in correct location
gcloud secrets describe ai-gateway-token --format="value(replication.userManaged.replicas[0].location)"
# Output: asia-southeast1

gcloud secrets describe directus-ai-agent-token --format="value(replication.userManaged.replicas[0].location)"
# Output: asia-southeast1

gcloud secrets describe gcs-credentials-test --format="value(replication.userManaged.replicas[0].location)"
# Output: asia-southeast1
```

---

## Old Secrets Status
All 3 old secrets have been DELETED:
- AI_GATEWAY_TOKEN - DELETED
- DIRECTUS_AI_AGENT_TOKEN - DELETED
- GCS_CREDENTIALS_test - DELETED

---

*Report generated by Claude Code as part of WEB-39 mission.*
